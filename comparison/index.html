



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A build and packaging tool and environment for OpenSwitch">
      
      
      
        <meta name="author" content="OpenSwitch">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>Comparison with opx-build - Docker-buildpackage Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#ff7043">
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#docker-buildpackage-and-opx-build" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Docker-buildpackage Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Docker-buildpackage Documentation
              </span>
              <span class="md-header-nav__topic">
                Comparison with opx-build
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/opx-infra/dbp" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      opx-infra/dbp
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Docker-buildpackage Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Docker-buildpackage Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/opx-infra/dbp" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      opx-infra/dbp
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../build-packages/" title="Building packages" class="md-nav__link">
      Building packages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../build-installers/" title="Building installers" class="md-nav__link">
      Building installers
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Comparison with opx-build
      </label>
    
    <a href="./" title="Comparison with opx-build" class="md-nav__link md-nav__link--active">
      Comparison with opx-build
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#on-opx-build-and-build-isolation" title="On opx-build and build isolation" class="md-nav__link">
    On opx-build and build isolation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#on-opx-build-and-container-persistence" title="On opx-build and container persistence" class="md-nav__link">
    On opx-build and container persistence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbp-and-backwards-compatibility" title="dbp and backwards compatibility" class="md-nav__link">
    dbp and backwards compatibility
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-comparison" title="Command Comparison" class="md-nav__link">
    Command Comparison
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../apt-sources/" title="Apt Sources" class="md-nav__link">
      Apt Sources
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../forking-upstream/" title="Forking Upstream" class="md-nav__link">
      Forking Upstream
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQs" class="md-nav__link">
      FAQs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#on-opx-build-and-build-isolation" title="On opx-build and build isolation" class="md-nav__link">
    On opx-build and build isolation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#on-opx-build-and-container-persistence" title="On opx-build and container persistence" class="md-nav__link">
    On opx-build and container persistence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbp-and-backwards-compatibility" title="dbp and backwards compatibility" class="md-nav__link">
    dbp and backwards compatibility
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-comparison" title="Command Comparison" class="md-nav__link">
    Command Comparison
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="docker-buildpackage-and-opx-build">Docker-buildpackage and <em>opx-build</em><a class="headerlink" href="#docker-buildpackage-and-opx-build" title="Permanent link">&para;</a></h1>
<p><em>dbp</em> is replacing <em>opx-build</em> to support more OS distributions, increase developer productivity, and lower operational overhead.</p>
<p><em>opx-build</em> contains scripts for running the OPX Docker image <a href="https://hub.docker.com/r/opxhub/build"><em>opxhub/build</em></a> (<code class="codehilite">opx_run</code>), building Debian packages with <a href="https://honk.sigxcpu.org/piki/projects/git-buildpackage/"><em>Git-buildpackage</em></a> (<code class="codehilite">opx_build</code>), and <a href="https://github.com/open-switch/opx-build/blob/master/scripts/opx_rel_pkgasm.py">building an OpenSwitch installer</a> (<code class="codehilite">opx_rel_pkgasm.py</code>).</p>
<h4 id="on-opx-build-and-build-isolation">On <em>opx-build</em> and build isolation<a class="headerlink" href="#on-opx-build-and-build-isolation" title="Permanent link">&para;</a></h4>
<p><em>opx-build</em> uses <a href="https://honk.sigxcpu.org/piki/projects/git-buildpackage/"><em>git-buildpackage</em></a>/<a href="https://wiki.debian.org/git-pbuilder"><em>git-pbuilder</em></a>/<a href="https://wiki.debian.org/cowbuilder"><em>cowbuilder</em></a> for building packages. This provides clean environments for every build, but is also rather redundant with the Docker image we provide. <em>dbp</em> resolves this issue by removing <em>git-pbuilder</em>/<em>cowbuilder</em> and running builds in the container directly. This also brings the added benefit of simplified environment management, as we can build one image per distribution, instead of one image containing every distribution.</p>
<h4 id="on-opx-build-and-container-persistence">On <em>opx-build</em> and container persistence<a class="headerlink" href="#on-opx-build-and-container-persistence" title="Permanent link">&para;</a></h4>
<p>With <em>opx-build</em>, the container is removed after every build. Developers are forced to manually run containers and execute shell sessions within them. <em>dbp</em> is built from the ground up around this workflow, supporting persistent containers and multiple shell sessions.</p>
<h2 id="dbp-and-backwards-compatibility"><em>dbp</em> and backwards compatibility<a class="headerlink" href="#dbp-and-backwards-compatibility" title="Permanent link">&para;</a></h2>
<p><em>dbp</em> maintains <em>some</em> backwards compatibility with <em>opx-build</em>. <code class="codehilite">opx_build</code> does not work without <em>pbuilder</em>, and <code class="codehilite">opx_run</code> does not work without Docker-in-Docker. The <a href="https://github.com/open-switch/opx-build/tree/installer/3.0.0"><em>installer/3.0.0</em></a> tag of <em>opx-build</em> is installed into <code class="codehilite">/usr/local/opx-build</code> and <code class="codehilite">/usr/local/opx-build/scripts</code> has been added to the <code class="codehilite">$PATH</code> to support installer building.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ dbp shell -c <span class="s1">&#39;which opx_rel_pkgasm.py&#39;</span>
/usr/local/opx-build/scripts/opx_rel_pkgasm.py
</pre></div>
</td></tr></table>

<h2 id="command-comparison">Command Comparison<a class="headerlink" href="#command-comparison" title="Permanent link">&para;</a></h2>
<p><strong>Build a single package</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ opx-build/scripts/opx_run opx_build src1

$ dbp build src1
</pre></div>
</td></tr></table>

<p><strong>Build all packages in a directory</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ opx-build/scripts/opx_run opx_build src1 src2 src3...

$ dbp build
</pre></div>
</td></tr></table>

<p><strong>Build an OPX installer</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ opx-build/scripts/opx_run opx_rel_pkgasm.py --dist stable <span class="se">\</span>
  -b opx-onie-installer/release_bp/OPX_dell_base_stretch.xml

$ dbp shell -c <span class="s1">&#39;opx_rel_pkgasm.py --dist stable \</span>
<span class="s1">  -b opx-onie-installer/release_bp/OPX_dell_base_stretch.xml&#39;</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../build-installers/" title="Building installers" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Building installers
              </span>
            </div>
          </a>
        
        
          <a href="../apt-sources/" title="Apt Sources" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Apt Sources
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/open-switch" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>